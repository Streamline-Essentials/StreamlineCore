buildscript {
    repositories {
        maven { url 'https://plugins.gradle.org/m2/' }
    }
    dependencies {
        classpath 'gradle.plugin.com.github.johnrengelman:shadow:7.1.2'
    }
}

plugins {
    id('java')
    id('com.github.johnrengelman.shadow') version '7.1.2'
}

sourceCompatibility = JavaVersion.VERSION_11
targetCompatibility = JavaVersion.VERSION_11

subprojects {
    apply plugin: 'java'
    apply plugin: 'com.github.johnrengelman.shadow'

    apply from: rootDir.toString() + '/dependencies.gradle'

    group = properties['group']
    version = properties['version']

    ext {
        pluginMain = properties['plugin.main'] == 'default' ?
                '${project.group}.${project.name.toLowerCase()}.${project.name}' :
                properties['plugin.main']
    }

    sourceCompatibility = JavaVersion.VERSION_11
    targetCompatibility = JavaVersion.VERSION_11

    repositories {
        mavenCentral()
        mavenLocal()

        // Spigot / Bukkit
        maven {
            url = 'https://hub.spigotmc.org/nexus/content/repositories/snapshots/'
            content {
                includeGroup 'org.bukkit'
                includeGroup 'org.spigotmc'
            }
        }
        maven { url = 'https://oss.sonatype.org/content/repositories/snapshots' }
        maven { url = 'https://oss.sonatype.org/content/repositories/central' }
        // Paper / Velocity
        maven { url 'https://repo.papermc.io/repository/maven-public/' }
        // Fabric
        maven { url 'https://maven.fabricmc.net/' }
        maven { url 'https://libraries.minecraft.net/' }

        // JitPack
        maven { url 'https://jitpack.io' }
        maven { url 'https://mvnrepository.com/artifact' }
        // OpenCollab
        maven { url 'https://repo.opencollab.dev/maven-snapshots/' }
        maven { url 'https://repo.opencollab.dev/maven-releases/'}

        // PlaceholderAPI
        maven { url 'https://repo.extendedclip.com/content/repositories/placeholderapi/' }
    }

    processResources {
        // Debugging: Print values
        doFirst {
            println 'Version: ${project.version}, Name: ${project.name}, Main: ${project.ext.pluginMain}'
        }

        inputs.property('name', '${project.name}')
        inputs.property('version', '${project.version}')
        inputs.property('main', '${project.ext.pluginMain}')

        filesMatching('**/plugin.yml') {
            expand (
                    'name': '${project.name}',
                    'version': '${project.version}',
                    'main': '${project.ext.pluginMain}',
            )
        }

        filesMatching('**/StreamlineVelocity.**') {
            expand (
                    'name': '${project.name}',
                    'version': '${project.version}',
            )
        }
    }

    shadowJar {
        manifest {
            attributes(
                    'Implementation-Title': '$project.name',
                    'Implementation-Version': '$project.version'
            )
        }

        relocate('tv.quaint.thebase.lib', 'net.streamline.thebase.lib')

        archiveFileName = project.name + '-' + project.version + '.jar'

        minimize()
    }

    artifacts {
        archives shadowJar
    }
}

wrapper {
    gradleVersion = '8.3'
    distributionType = Wrapper.DistributionType.ALL
}
